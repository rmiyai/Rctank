<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <title>tank controller</title>
    <script type="text/javascript" src="/webiopi.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/rctank.css" rel="stylesheet">
    <script type="text/javascript">

webiopi().ready( function()
{	// Initialize
	drive( 0 );
	vlevel( 5 );
} );

</script>
</head>
<body>
    <h1>TankController</h1>
    <a class="btn btn-primary">button</a>
    <h2 id="msg">&nbsp;</h2>
    <img src="http://192.168.1.201:9000/?action=stream" style="float:left; width:400px;">
    <input type="button" value="pic" onclick="snap()">
    <div>
    </div>
    <div>

    <input type="range" min="1" max="10" value="4" onchange="vlevel (this.value)">
    </div>

    <a href="index.html">写真を見る</a>
    <script type="text/javascript">
        var cnt = 0;
        function drive(mode){   // Change drive mode. 0 : Stop, 1 : Forward, 2 : Backward, 3 : CW, 4 : CCW
        webiopi().callMacro( "ChangeDriveMode", mode );
        }

        function vlevel(level){ // Change Voltage Level.
            webiopi().callMacro( "ChangeVoltageLevel", level);
        }

        //静止画撮影マクロを呼ぶ関数
        function snap(){
            webiopi().callMacro("SnapShot", null, successTakePic);
        }

        document.onkeydown = function (e){
            cnt++;
            if(cnt == 1){
                var code = e.keyCode;
                console.log(code);
                if(code == 37){
                    drive(4);
                }else if(code == 38){
                    drive(1);
                }else if(code == 39){
                    drive(3);
                }else if(code == 40){
                    drive(2);
                }
            }
        }

        document.onkeyup = stop;
        function stop(e){
            cnt = 0;
            drive(0);
        }

        function successTakePic(macro, args, data){
            var msgNode = document.getElementById('msg');
            var code = data;
            console.log(code);
            if(code == 0){
                msgNode.innerHTML = 'success';
            }
        }
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
</body>
</html>